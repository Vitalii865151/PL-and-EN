<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Language Learning</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 12px; box-sizing: border-box; background-color: #d3d3d3; }
    .top { margin-bottom: 8px; }
    .btn { display:inline-block; padding:8px 12px; margin-right:6px; cursor:pointer; border:1px solid #888; border-radius:4px; user-select:none; }
    .btn.active { background:#ddd; box-shadow: inset 0 0 3px rgba(0,0,0,0.2); }
    .container { height: calc(100vh - 140px); overflow:auto; border-top:1px solid #eee; padding-top:8px; }
    .row { display:flex; align-items:center; gap:8px; padding:6px; border-bottom:1px solid #f0f0f0; }
    .num { width:40px; text-align:right; font-size:14px; }
    .text { width:500px; flex:0 0 500px; font-size:14px; white-space:pre-wrap; }
    .entry { flex:0 0 280px; font-size:14px; padding:6px; }
    .status { width:32px; text-align:center; font-size:18px; }
    .check, .hint { width:36px; height:30px; cursor:pointer; }
    .controls { margin-bottom:6px; }
    .save-note { margin-left:12px; font-size:13px; color:#555; }
    .timer { font-size:16px; margin-left:12px; }
    /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –º–µ–Ω—å—à–µ 978px */
    @media (max-width: 978px) {
      .row {
        flex-wrap: wrap;        /* —Ä–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
      }
      .entry {
        flex: 1 1 100%;         /* –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
        min-width: 0;           /* —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞–ª–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
      }
      .status, .check, .hint {
        margin-top: 4px;        /* —á—É—Ç—å –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
      }
    }
    /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ –º–µ–Ω—å—à–µ 978px */
  </style>
</head>
<body>
  <div class="top">
    <div class="controls">
      <span id="btnPl" class="btn">Polish</span>
      <span id="btnEn" class="btn">English</span>
      <button id="downloadProgress" class="btn">Save progress</button>
      <button id="btnTimer" class="btn">Start Timer</button>
      <span id="lblTimer" class="timer">‚è± 0.0s</span>
      <span class="save-note">(–°–∫–∞—á–∏–≤–∞–µ—Ç progress.json ‚Äî –±—Ä–∞—É–∑–µ—Ä –Ω–µ –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –ø—Ä—è–º–æ –≤ –ø–∞–ø–∫—É)</span>
    </div>
  </div>

  <div class="container" id="container"></div>

<script>
let blocks = [];
let progress = {};
let currentLang = 'pl';

const container = document.getElementById('container');
const btnPl = document.getElementById('btnPl');
const btnEn = document.getElementById('btnEn');
const downloadBtn = document.getElementById('downloadProgress');
const btnTimer = document.getElementById('btnTimer');
const lblTimer = document.getElementById('lblTimer');

// –¢–∞–π–º–µ—Ä
let startTime = null;
let running = false;

function updateTimerDisplay() {
  if (running && startTime !== null) {
    const totalSeconds = Math.floor((Date.now() - startTime) / 1000);
    const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
    const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
    const secs = String(totalSeconds % 60).padStart(2, '0');
    lblTimer.textContent = `‚è± ${hrs}:${mins}:${secs}`;
    setTimeout(updateTimerDisplay, 500); // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫
  }
}


function startTimer() {
  startTime = Date.now();
  running = true;
  btnTimer.textContent = 'Stop Timer';
  lblTimer.textContent = '‚è± 0.0s';
  updateTimerDisplay();
}

function stopTimer() {
  if (running && startTime !== null) {
    const totalSeconds = Math.floor((Date.now() - startTime) / 1000);
    const hrs = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
    const mins = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
    const secs = String(totalSeconds % 60).padStart(2, '0');
    lblTimer.textContent = `‚è± ${hrs}:${mins}:${secs}`;
  }
  running = false;
  btnTimer.textContent = 'Start Timer';
}


function toggleTimer() {
  if (!running) startTimer();
  else stopTimer();
}

btnTimer.addEventListener('click', toggleTimer);

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
function saveProgressFile() {
  const blob = new Blob([JSON.stringify(progress, null, 2)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'progress.json';
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
}

downloadBtn.addEventListener('click', saveProgressFile);

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —è–∑—ã–∫–∞
function setActiveButton() {
  if (currentLang === 'pl') {
    btnPl.classList.add('active');
    btnEn.classList.remove('active');
  } else {
    btnEn.classList.add('active');
    btnPl.classList.remove('active');
  }
}

btnPl.addEventListener('click', () => { currentLang = 'pl'; setActiveButton(); renderBlocks(); });
btnEn.addEventListener('click', () => { currentLang = 'en'; setActiveButton(); renderBlocks(); });

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
function checkAnswer(idx, entryEl, statusEl) {
  const targetLang = (currentLang === 'pl') ? 'en' : 'pl';
  const userInput = (entryEl.value || '').trim().toLowerCase();
  const correct = (blocks[idx] && blocks[idx][targetLang]) ? blocks[idx][targetLang].trim().toLowerCase() : '';
  if (userInput === correct && userInput !== '') {
    progress[String(idx)] = true;
    statusEl.textContent = '‚úÖ';
  } else {
    progress[String(idx)] = false;
    statusEl.textContent = '‚ùå';
  }
  // –µ—Å–ª–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ ‚úÖ ‚Äî —Å—Ç–æ–ø —Ç–∞–π–º–µ—Ä
  if (blocks.length > 0 && blocks.every((_,i)=>progress[String(i)])) {
    stopTimer();
  }
}

// –ü–æ–¥—Å–∫–∞–∑–∫–∞
function toggleHint(idx, entryEl, btnEl) {
  const targetLang = (currentLang === 'pl') ? 'en' : 'pl';
  const correctText = blocks[idx][targetLang];
  if (entryEl.value === correctText && entryEl.style.color === 'gray') {
    entryEl.value = '';
    entryEl.style.color = 'black';
    btnEl.classList.remove('active');
  } else {
    entryEl.value = correctText;
    entryEl.style.color = 'gray';
    btnEl.classList.add('active');
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –±–ª–æ–∫–æ–≤ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
fetch('blocks.json')
  .then(r => r.json())
  .then(data => { blocks = data; renderBlocks(); })
  .catch(err => { container.innerHTML = '<div style="color:red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ blocks.json</div>'; });

fetch('progress.json')
  .then(r => r.json())
  .then(data => { progress = data; renderBlocks(); })
  .catch(_ => { progress = {}; });

// –†–µ–Ω–¥–µ—Ä –±–ª–æ–∫–æ–≤
function renderBlocks() {
  container.innerHTML = '';
  setActiveButton();
  blocks.forEach((block, idx) => {
    const row = document.createElement('div');
    row.className = 'row';

    const num = document.createElement('div');
    num.className = 'num';
    num.textContent = (idx+1)+'.';

    const text = document.createElement('div');
    text.className = 'text';
    text.textContent = block[currentLang] || '';

    const entry = document.createElement('input');
    entry.className = 'entry';
    entry.type = 'text';
    entry.style.color = 'black';
    entry.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') checkAnswer(idx, entry, status);
      if (entry.style.color === 'gray') {
        entry.value = '';
        entry.style.color = 'black';
        btnHint.classList.remove('active');
      }
    });

    const status = document.createElement('div');
    status.className = 'status';
    if (String(idx) in progress) {
      status.textContent = progress[String(idx)] ? '‚úÖ' : '‚ùå';
    }

    const btnCheck = document.createElement('button');
    btnCheck.className = 'check';
    btnCheck.textContent = '‚úî';
    btnCheck.addEventListener('click', () => checkAnswer(idx, entry, status));

    const btnHint = document.createElement('button');
    btnHint.className = 'hint';
    btnHint.textContent = 'üí°';
    btnHint.addEventListener('click', () => toggleHint(idx, entry, btnHint));

    row.appendChild(num);
    row.appendChild(text);
    row.appendChild(entry);
    row.appendChild(status);
    row.appendChild(btnCheck);
    row.appendChild(btnHint);

    container.appendChild(row);
  });
}
</script>
</body>
</html>
